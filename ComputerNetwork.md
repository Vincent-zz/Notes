# 计算机网络  

## 网络概述
---
### 网络的组成
- 结点（node）：每台独立计算机是一个结点
- 链路（link）：链接结点

### 互联网（internet - "network of network"）
- 网络
- 路由器：互联网络

### 因特网（Internet） 

因特网是最大的互联网，采用TCP/IP协议族作为通信规则 

因特网协会（ISOC）：全面管理因特网的国际协会 

Internet组成： 
- 边缘部分：各种电脑、服务器、手机、物联网智能硬件
- 核心部分：大量网络与路由器组成，为边缘部分提供服务
  
**ISP（Internet service provider）** 

个人用户通过ISP接入Internet，ISP收费提供IP地址、路由器 

Internet基于ISP可被分成多层结构，如第一层国际性区域主干网ISP，第二层国家性ISP（多为大公司，如电信、联通、移动），第三次区域性ISP，……，直到个人、企业网、校园网等用户（实际上，ISP结构已日渐复杂） 

每个用户只要能连入Internet都有条件成为ISP 

### 网络的分类
- 交换技术
  - 电路交换网络
  - 报文交换网络
  - 分组交换网络
- 使用者
  - 公用网（公众网）
  - 专用网（如军队网络）
- 覆盖范围
  - 广域网WAN：覆盖区域很大，全球、国家级网络，是因特网的核心部分
  - 城域网MAN：城市骨干网，互联企业、校园局域网等
  - 局域网LAN：小范围，楼栋、校园，现在的校园网大多互联了多个局域网
  - 个域网PAN：连接个人电子设备，如鼠标、打印机
- 传输介质
  - 有线网
  - 无线网
- 拓扑结构
  - 总线型
  - 星型
  - 环型
  - 网状型

### 路由器：分组交换 

用户段的消息全体数据（“报文”）被分解为大量等长的小数据段 

小数据段加上一个由必要信息（如目的地址、顺序信息、应用进程等）构成的首部，成为一个“分组”，又称“包”（首部又称“包头”） 

各个分组经过互联网中的各个分组交换机（路由器）转发到接收端用户（各个分组经过的路径大多各不相同，到达的顺序也是混乱的） 

接收端将各分组重新组合还原报文 

路由器在分组交换中的任务：
- 缓存分组
- 转发分组

### 计算机网络性能指标 
- 速率（比特率、数据率）：连接于网络上的*主机在信道上*传输比特的速率（单位：bps）
- 带宽（最高数据率）：由模拟系统频率的范围而来，表示计算机网络*信道*传输数据的能力（单位：bps）
- 吞吐量：单位时间内通过*某网络或某接口*的数据量，受带宽与额定速率限制（单位：bps）
- 时延
  - 发送时延（源主机）：`分组长度（b）/发送速率（bps）`，发送速率受网卡速率、信道带宽、路由器接口速率限制
  - 传播时延（信道）：`信道长度（m）/信号传输速率（m/s）`
  - 处理时延（路由器）：动态变化，难以计算
- 时延带宽积：`传播时延（s）*带宽（bps）`，表示以比特为单位的链路长度（单位：b）
- 往返时间（RoundTripTime）：源主机发送分组到收到目标主机发送回来的分组的时间
- 利用率
  - 信道利用率：某信道被利用的时间百分比，太低浪费资源，太高会增大处理时延，主干信道大多保持在50%以下
  - 网络利用率：全网所有信道利用率的加权平均
- 丢包率：一定时间范围内丢失的分组的比例，传输过程中出现误码（被结点丢弃）或接口路由器缓冲区已满（通信量过大，网络拥塞）会造成丢包，所有丢包率一定程度上反映了网络拥塞程度

\* 作为速率单位时 1 Tbps = *10*^3 Gbps = *10*^6 Mbps = *10*^9 kbps = *10*^12 bps 

\* 对n个等长分组经由多个带宽相同的链路的总时延的计算（处理时延不计）实际上只需考虑：
- 最开始发送第一个分组到最开始发送最后一个分组间的n - 1个发送时延
- 外加最后一个分组发送、传播的总时延即可 

## 计算机网络体系结构 
---
### 常见体系结构 
- 法律上的国际标准：OSI体系（7层）
- 实际上的国际标准：TCP/IP体系（4层，路由器一般仅包含以下前两层），能够接入因特网的主机操作系统中有着符合TCP/IP体系标准的TCP/IP协议族
  - 网络接口层：无具体内容，可以互联各种接口
  - 网际层：IP协议为核心协议，负责互联接口层的不同接口（IP over everything），在IP向运输层协议提供互联服务的基础上运输层协议向应用层协议提供服务（everything over IP）
  - 运输层：TCP（稳定）、UDP（不稳定）协议为重要协议
  - 应用层：各种应用协议，如HTTP、SMTP、DNS、RTP……
- 用于教学的原理结构：将TCP/IP的接口层分为物理层与数据链路层（5层，路由器为前三层）

**体系结构的大致运作方式例** 

总的来说就是反反复复、层层加码、层层解码 

用户主机的应用层的浏览器生成符合http协议的请求报文， 

报文逐层处理加工（应用层到运输层到网际层到链路层到物理层）， 

由物理层传到服务器，服务器又逐层解读报文（物理层到链路层到网际层），获取目的地信息， 

再重新逐层加工（网际层到链路层到物理层），发送到下一个接口， 

最终网页服务器收到报文，逐层解读报文（物理层到链路层到网际层到运输层到应用层），在应用层得到请求报文，生成响应报文，再以同样的方式发送回用户主机 

### 网络体系结构的一些概念
- 实体：任何可收发信息的软硬件，处在同一层次的实体又称对等实体
- 协议：对等实体间进行（*逻辑上的*）通信的规则的集合
  - 语法：要交换的信息的格式
  - 语义：定义对应语法通信双方所要进行的操作
  - 同步：定义收发双方的时序关系
- 服务：对等实体在协议控制下对下一层提供服务，同理，协议的实现需要上一层提供的服务来实现（*下一层并不在乎上一层使用的是何种协议，只要提供了本层协议实现所需的服务即可*）
  - 服务访问点：指相邻两层实体间交换信息的逻辑接口，如数据链路层的帧、网络层IP首部中的协议字段、运输层的端口号
  - 服务原语：层之间为获取服务所需交换的命令
- PDU协议数据单元：对等层次间（*逻辑上*）交换的数据包，如比特流（物理层）、帧（链路层）、IP数据报又称分组又称包（网路层），TCP、UDP报文（运输层），报文（应用层）
- SDU服务数据单元：同一系统层与层之间交换的数据包，多个SDU可合成一个PDU

## 物理层 
---
### 物理层的基本概念 

物理层解决通过传输媒体传输比特流的问题，为数据链路层提供服务（为数据链路层屏蔽了各种传输媒体的差异） 

物理层协议的主要任务 
- 机械特性：接口引脚个数、接头型号尺寸等等
- 电气特性：各电缆上的电压等
- 功能特性：高低电平的携带的信息、意义
- 过程特性：不同功能、可能事件发生的过程、顺序

### 传输媒体 
- 导引型传输媒体：同轴电缆、双绞线（绞合是为了抗电磁干扰）、光纤、电力线等
- 非导引型传输媒体：无线电波、微波、红外线、可见光等 

### 传输方式 

（1）
- 串行传输：单线例如计算机网络的信息传输
- 并行传输：多线例如CPU内部总线

（2）
- 同步传输：稳定的比特流传输，字节之间同步、无间隔，接收端以一定频率读取字节中某位特定比特的信息，需要同步收发双方*时钟*（例如以固定频率的方波为时钟，每到上升沿接收端就读取此刻数据线中的信息）
  - 内同步：将时钟信号编码入待发送的数据
  - 外同步：另设一条时钟信号线（然而时钟信号与数据信号因为各种传输线的电导率、长度等物理特性不同，难免产生*时钟相位*的偏移，可能造成错误的数据读取）
- 异步传输：以独立的字节（外加起始位和结束位）为单位传输，字节之间异步、间隔不定（但每个字节内的比特是同步的），接收端在每个字节起始处同步

（3）
- 单工：一条信道单向传输数据，如收音机
- 半双工：两条信道可双向传输，但不能同时，如对讲机
- 全双工：两条信道可同时双向传输数据，如电话

### 编码与调制 

- 编码：转为数字信号
  - 不归零：码元为连续的正或负，存在同步问题
  - 归零：码元先为正或负后归零，以零为时钟实现内同步，但浪费带宽
  - 曼彻斯特（传统以太网使用）：码元为正到负或负到正，其中间的上升沿、下降沿同时代表时钟与数据
  - 差分曼彻斯特：码元中的上升沿、下降沿仅代表时钟，以码元起始电平（相比上一个码元结束电平）是否发生变化表示数据
- 调制：转为模拟信号
  - 基本调制方法：每个码元只能传输一位数据
    - 调幅（AM）
    - 调频（FM）
    - 调相（PM）
  - 混合调制：混合调制振幅、频率与相位，例如正交振幅调制（QAM），达到一个码元多位数据的效果

\* 曼彻斯特编码如何实现同步（相邻码元之间也可能存在上升沿或下降沿）？相邻升降沿间的间隔要么半个码元要么一个码元，接收端会识别这两种间隔，仍然可以获取正确的时钟信号 

### 信道的极限容量 

**奈氏准则** 
- 理想低通信道最高码元传输速率：2W Baud = 2W 码元/s 
- 理想带通信道最高码元传输速率：1W Baud = 1W 码元/s 

\* 信道频率带宽：W Hz，此带宽非网络性能指标中的彼带宽 


**香农定理**（考虑高斯噪声） 
$$c = W \log _ 2(1 + \frac{S}{N})$$
c：信道极限传输速率（单位：bps） 

W：信道频率带宽 

S：信号平均功率 

N：高斯噪声功率 

信噪比（单位：dB）： 

$$ 10 \lg(\frac{S}{N}) $$ 

为提高信道容量，根据奈氏准则，应当增大调制速度（每个码元的比特数）；根据香农定理，应当增大信噪比 

## 数据链路层 
---
### 关于帧 

**封装**： 

对上层的协议数据单元（也就是网路层的包）添加帧头、帧尾，封装成帧 

数据部分相比帧头帧尾越大传输效率越高 

**读取**： 

从比特流中分离出帧，不同的链路层协议对应不同的分离方法，如PPP帧的帧头帧尾包含特定标志用来界定帧，以太网V2的MAC帧在物理层会加入前导码并规定帧之间的时间间隔 

**透明传输**： 

数据链路层对于帧头帧尾中间的数据应当无任何限制 

可能出现的问题：PPP帧内部的数据中有一段与帧尾标志相同的数据，则这个帧传输到接收端时将无法完整读取 

解决方法：
- 字节填充：扫描帧，在其中与界定帧标志相同的字节前（以及与转义字符相同的字节前）加入转义字符
- 比特填充：如HDLC协议的界定标志为01111110，则在帧中每五个连续的1后插入一个0

### 关于数据链路层与物理层貌似有些混乱的关系 

个人理解： 

关键在于把*将比特流读取为帧*的这一过程划归于那一个层，因为读取时是会用到链路层协议的，如果仅仅将物理层视为负责传输的一层，读取归于链路层，那么两层间的协议可以独立、透明，与其他层间的协议一致；若要将读取归于物理层，物理层给链路层提供帧这种协议数据单元，这又与其他层间提供服务的关系（如链路层为网际层提供包）一致。 

个人倾向于前者， 但毕竟在TCP/IP体系中两个层是一体的，所以感觉也没啥必要把这两个层分辨得过于明晰 

### 差错检测 

检测经过物理层传输之后的比特流的出错情况并纠正 
- 奇偶校验：so咦贼，容易漏检
- 循环冗余校验（CRC）